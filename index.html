<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Transferida — Visual Novel (Completo)</title>
  <style>
    :root{--beige:#f3e0cf;--brown:#9a4a1a;--ui-dark:rgba(0,0,0,0.6);--muted:#d7cbb8}
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body,#app{height:100%;width:100%;background:#000}
    body{overflow:hidden}

    /* fullscreen layout */
    #app{position:fixed;inset:0;display:flex;align-items:stretch;justify-content:stretch}
    .stage{flex:1;position:relative;background-size:cover;background-position:center center;display:flex;align-items:center;justify-content:center}

    /* menu overlay */
    .menuOverlay{position:absolute;left:4vw;top:10vh;width:30vw;max-width:520px;display:flex;flex-direction:column;gap:18px}
    .menuLogo{font-size:clamp(28px,4vw,44px);font-weight:900;color:var(--brown);text-shadow:0 4px 0 rgba(0,0,0,.25)}
    .menuArt{height:72px;width:72px;border-radius:8px;object-fit:cover}
    .playButton{background:var(--brown);color:var(--beige);font-weight:900;padding:18px 26px;border-radius:8px;border:10px solid rgba(243,224,207,0.95);font-size:clamp(28px,3.8vw,54px);cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    .small{color:var(--muted);font-size:14px}

    /* creator tag */
    .creatorTag{position:absolute;right:2.5vw;bottom:2.5vh;color:var(--beige);font-weight:800;text-shadow:0 2px 0 rgba(0,0,0,.35);font-size:clamp(12px,1.5vw,20px)}

    /* character */
    .charWrap{position:relative;z-index:3;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .charWrap img{max-height:86vh;max-width:60vw}

    /* dialogue UI */
    .ui{position:absolute;left:50%;transform:translateX(-50%);bottom:3vh;width:92%;max-width:1400px;display:flex;flex-direction:column;gap:12px;align-items:stretch;z-index:6}
    .nameBox{align-self:flex-start;background:var(--brown);color:var(--beige);padding:14px 18px;border-radius:6px;border:8px solid var(--beige);font-weight:900;font-size:clamp(18px,2.2vw,30px)}
    .dialogueBox{background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.45));border-radius:8px;padding:18px 22px;border:8px solid rgba(243,224,207,0.95);min-height:96px;display:flex;align-items:center}
    .dialogueText{color:var(--beige);font-size:clamp(16px,1.9vw,22px);line-height:1.45}

    /* large centered choices */
    .choicesContainer{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:7}
    .choicesInner{display:flex;flex-direction:column;gap:18px;pointer-events:auto}
    .choiceBtn{background:var(--beige);color:var(--brown);font-weight:900;padding:18px 40px;border:12px solid rgba(154,74,26,0.95);font-size:clamp(22px,3vw,44px);border-radius:6px;cursor:pointer;box-shadow:0 12px 30px rgba(0,0,0,.45)}

    /* fade */
    .fadeIn{animation:fadeIn .35s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    @media(max-width:720px){.menuOverlay{left:5vw;top:6vh;width:86vw}.playButton{padding:12px}.nameBox{padding:10px}.dialogueBox{padding:12px}.choiceBtn{padding:12px 18px;font-size:20px}}
  </style>
</head>
<body>
  <div id="app">
    <div id="stage" class="stage" style="background-image:url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjJIdENAJVgqTQDsjT21lO4Rm2sc1IV3Qt-ViY76pamcH_OhUouZ0yvKbHAZ6pHt2O_vgyk6ftATy2sLXrE55MfNfTwlazc2DbkCT-0bT9uaXQSvyBuaPTRWFxTzDuSo_DIg2CH8W4o34H-_0doZdZS7o_80cbC8vPVHHv7JyBC0sz6PT5mR2EBVDx9xrkR/s320/1f28dff2-9eda-40dc-aa50-272e6f3d114d.png')">

      <div class="menuOverlay fadeIn" id="menuOverlay">
        <img class="menuArt" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbmefjKbkNBKcqJy7UdSK882TD8EE8O4e30uqSUaAIMQqKgXUzL6tOq4OwMrBdgyaCmUVv76tPUoDLQ_EbLYc8aM8NVRDp6u0RaBNTWOfd0Qm52APoExfVmhG9jyGW3JqcE_R_cJQuMI6Oo4xdybpjhG43h8rABRZyTxNwzDpzkIx7EGnBtlb8GiGzamz3/s320/7fd3a151-778d-40e6-a9ce-d59fb56b6595.png" alt="arte">
        <div class="menuLogo">Transferida</div>
        <div class="small">Uma história sobre timidez, coragem e conexões</div>
        <button id="playBtn" class="playButton">PLAY</button>
        <div style="display:flex;gap:8px;margin-top:6px">
          <button id="continueBtn" class="choiceBtn" style="font-size:14px;padding:10px 16px;border-width:8px">Continuar</button>
          <button id="loadBtn" class="choiceBtn" style="font-size:14px;padding:10px 16px;border-width:8px">Carregar</button>
        </div>
      </div>

      <div class="charWrap" id="charWrap">
        <img id="charImg" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdG6e5sjfiLbvSbtVGxFIX_LmGxXh7wRWzg_ZgqxeDvxsAXAldYsgWPhyphenhyphentlbmJX4ZQnGl7ypGO6sed3JdnGqt3KC_pGsOXgD3TKnTsif8dK_gMBcwJ-8sD4IxKyzQamy7dIQSZhez4dSYQ4NH7X9SBjvIWVhREIkfctaoJQGg-qHMGQvtgJ9bsYpfpmz0U/s320/63ad9301-3cdc-4956-9826-aabba17021fc.png" alt="personagem">
      </div>

      <div class="creatorTag">CRIADO POR: YAN COMERLATTO MASSONI</div>

      <div class="ui" id="ui" style="display:none">
        <div class="nameBox" id="nameBox">[Sistema]</div>
        <div class="dialogueBox">
          <div class="dialogueText" id="dialogueText">Bem-vindo(a). Clique para avançar.</div>
        </div>
      </div>

      <div class="choicesContainer" id="choicesContainer" style="display:none">
        <div class="choicesInner" id="choicesInner"></div>
      </div>

    </div>
  </div>

  <script>
    // expressions and backgrounds provided by user
    const EXPRESSIONS = {
      neutral: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdG6e5sjfiLbvSbtVGxFIX_LmGxXh7wRWzg_ZgqxeDvxsAXAldYsgWPhyphenhyphentlbmJX4ZQnGl7ypGO6sed3JdnGqt3KC_pGsOXgD3TKnTsif8dK_gMBcwJ-8sD4IxKyzQamy7dIQSZhez4dSYQ4NH7X9SBjvIWVhREIkfctaoJQGg-qHMGQvtgJ9bsYpfpmz0U/s320/63ad9301-3cdc-4956-9826-aabba17021fc.png',
      uncomfortable: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj57HEfWxF7k2EwEY2qiX4w7kzhf_WXbhygRHNgOFmCDsn67USVncB37DrIKASpUpLVv055XzrPjQcR-Evv2AdXX7cpleZypH1JoEsnmG3MyBnI5i7Ae2EhQxIO0GMir2PQvsZo-hUEGkGU3Z_lacDG0a7nkNBWNBjBATObetW78RyvVvomEXFQoxJfnF6i/s320/38dbc72f-adc5-4736-a151-3f9de6e6a7d1-removebg-preview.png',
      shy: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhsyGAEZ9nzbS8RpxfWa5TMZz5QWoR7wFj_j5qHGNGnu6qDQRjpyjwA-VE-pXfjG-ShHfqyUIzRiYsF74dfEw0tAgOVL6pspbfwe6LJczWMEJI87kW-PuI3qqsEYX8o0RgDageRemNCGCMX6iwt8jI-LbJEUcUf53nvIR71oFpZeWU41dXjC7TYkszEO_am/s320/image-removebg-preview%20(20).png',
      happy: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh9la3On91cbXMdMpHtbNBY8KA2EujruvL9NhjzrQ0C-97z5-QzPU5rNdvUSswIIYDrzkLmlr-VJWydfC8sDp5PjBamztTsqMJZGwmnR2EzdOD_8VNKqBepo32j8B0gTZwRiMo-iH8U7BD4vOjK-pNxiY_BRBxvAa1hnUq-0QSKwUQVClJ2Ff3BPj3iTWo6/s320/image-removebg-preview%20(21).png',
      sad: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjP6B6yiU2kgRbV-RFjrGi02YfUOAW28T4658XGJg2UDKpmeUEQtHzT62WB5XKAubxcSCnBHXWt9tlvJhotsgL1bq6rmNjPBL2LdbaDmgtkFvkyhVZrsgGGTHT6SklZJFwvZQNTHc-oX4PDFuvRbxGC-_GNlntAoMgJYEoIeNJfbc3vMK8v6zfU3Zh-bXBq/s320/image-removebg-preview%20(22).png',
      angry: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg3sQ77kGYV_0_uNMV82EiRzpNjr60lctM41yl8QWFixf9affV9kW1-HCFeR48ku8X9oDFlgWiGEgPDd9syFLMZgmBC9OmKsDFCFLqlIfZ4Aj42SaTWr_Qqxf70svG-A0e_L0jgGtOzFHqOllxzY5p4gL8yAZ17DyqoHnPinRmCzpoi-MunbRscLZGO3iRR/s320/image-removebg-preview%20(23).png',
      surprised: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilnbH9h6X0cwNyy2X5_63Ml6DVktg3IdS3go4Zk8krhNhhLlsjEMVGY-PRKFjcPWiQ4LgmIQhhnz9HqzVA9LKdJUUJuR2GQBxw0hPPXXwBgAnzmEdWZz5EEP-meZBFdYI_dfcNjH0KEVaDzyxPgswnAd8ym3srLwCtE7js9lBUo-batFsJWzsYDDKNa57n/s320/3fdf9aee-6f8e-4324-a71a-6a23b6b6dd4e.png',
      romantic: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgOSmp99WsQKTTi6f7L0soPMDlqptx4PNyIkzgqvrP3Zn5qrkpw5Tv8VWGKnRwq7cVFfI61_uGiyBX0qR-b7ayAmAOgMQrUOjsutXavbOzkgHjou1S4gr4holfvasFcwdNyc7PYEdQDbnyt3bm4j7MM9glTl7jN6kzIMESHWYa4dQumAkswcoRBIdWY7NH2/s320/459765c8-bc95-4be8-a9da-7fd2cb19b402.png'
    };

    const BACKGROUNDS = {
      classroom: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjJIdENAJVgqTQDsjT21lO4Rm2sc1IV3Qt-ViY76pamcH_OhUouZ0yvKbHAZ6pHt2O_vgyk6ftATy2sLXrE55MfNfTwlazc2DbkCT-0bT9uaXQSvyBuaPTRWFxTzDuSo_DIg2CH8W4o34H-_0doZdZS7o_80cbC8vPVHHv7JyBC0sz6PT5mR2EBVDx9xrkR/s320/1f28dff2-9eda-40dc-aa50-272e6f3d114d.png',
      corridor: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiwiK8RXZ2nlILZd6UGmDVOmDyQwB75RPkCajEf25wIYcc2lzVkelRyEGR-uqlpdUaUYfx6MXRNcsP61P6gwPwWTR0JgsiLjmanAu6fjIM_Ran9-uBVq-HOk8tO1sjAjdFAHRvVIknXgVHMQasCs56WHtIXvPs7UbONOR5ZiyqteuQ7pBhtAlm2p9xU-IMK/s320/302624f7-28c7-4504-997b-605a17d08aee.png',
      library: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEidX2J7SNrB70DkBK722ZQJ_woMipa0yTd_8taF8Jze-qNvxHvlSy1dQCrvWTXs89mgSAdEtdDrdzqMdCgSlJ9wnFGO6BbDG9dl2UIDmPtYvTUUFKVvXvVwjQiS82a_MYqBk8qIMQL83yGSlfN3Qhtrb_keC2R3PaugNsZkf2Qs6ugyXHOQPAGz-5Yw1U3u/s320/dc5dbbf1-9147-481d-b212-8a725307a261.png',
      yard: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgtkCqfrwELTVFVub9ZsINhIoQyyoD6qCxhZu_D4_Yeml7jlN6GZbQdJr1AI6rWnyp9si3WKnlD3t7eb1GHc0ERvazctJWZu3nvWaC86dmPV9UI8srFINATAIOByoj5U3LQZpWw07k1M5Tvf0N-983645wpJvDwyk_-oAv0XDLtd9YCfiKM0u5f1xte-1qf/s320/25c9779d-f2b4-4bd2-9955-4fc3c1f36b49.png',
      street: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjU03KO_GkbUfBWgVQiDfd7A0r3mcSVdQGuQOa1elc0IZ59bu9Cdr4NAeaVQ9fZM7ScgxW8MGIaeLHyT57OzN95EZF62pGh0lfeEFaMiV52XLhSwSi6Ut4bljWRV4X3ApFX46IV40iIGZl6TuVUdAiOYSaOexa3w101uCb48A2u9cn_ECCInrM1EJlHIvQw/s320/f08408c7-9ab7-49f4-bea8-96c35ff47669.png'
    };

    // DOM refs
    const stage = document.getElementById('stage');
    const menuOverlay = document.getElementById('menuOverlay');
    const playBtn = document.getElementById('playBtn');
    const continueBtn = document.getElementById('continueBtn');
    const loadBtn = document.getElementById('loadBtn');
    const charImg = document.getElementById('charImg');
    const ui = document.getElementById('ui');
    const nameBox = document.getElementById('nameBox');
    const dialogueText = document.getElementById('dialogueText');
    const choicesContainer = document.getElementById('choicesContainer');
    const choicesInner = document.getElementById('choicesInner');

    // game state
    const state = { playerName:'Você', affection:0, sceneKey:'menu', lines:[], lineIndex:0, pendingChoices:null };

    // full story scenes (Acts 1-4 expanded)
    const SCENES = {
      menu:{ bg:BACKGROUNDS.classroom },

      // Act 1
      intro:{ bg:BACKGROUNDS.classroom, lines:[
        {s:'Sistema',t:'Você está em um dia comum na escola. O professor entra com uma novidade.'},
        {s:'Professor',t:'— Turma, hoje temos uma nova aluna.'},
        {s:'Narrador',t:'Ela entra devagar, evita contato visual e se senta no fundo da sala. Todos cochicham.'}
      ], choices:[
        {text:'Ignorar e continuar a aula',action:()=>goTo('observe')},
        {text:'Tentar puxar papo no intervalo',action:()=>goTo('first_contact')},
        {text:'Observar discretamente',action:()=>goTo('observe')}
      ]},

      observe:{ bg:BACKGROUNDS.classroom, lines:[{s:'Narrador',t:'Você observa. Ela segura um livro como se fosse um escudo. Parece deslocada.'}], choices:[{text:'Ir para o intervalo',action:()=>goTo('yard')}]},

      // Act 2
      first_contact:{ bg:BACKGROUNDS.yard, lines:[
        {s:'Você',t:'Oi, eu sou {playerName}. Posso me sentar aqui?'},
        {s:'Ela',t:'...Tudo bem.'},
        {s:'Narrador',t:'Ela fala pouco, parece desconfortável, mas não é hostil.'}
      ], choices:[
        {text:'Fazer uma piada leve',action:()=>{ state.affection+=1; goTo('approach'); }},
        {text:'Falar sobre você primeiro',action:()=>{ state.affection+=1; goTo('approach'); }},
        {text:'Dar espaço e recuar',action:()=>goTo('observe')}
      ]},

      approach:{ bg:BACKGROUNDS.library, lines:[
        {s:'Narrador',t:'Vocês se encontram mais vezes — biblioteca, corredor. Aos poucos, ela mostra pequenas reações.'},
        {s:'Ela',t:'Eu me mudei de outra cidade. Não é fácil confiar nas pessoas.'}
      ], choices:[
        {text:'Insistir em conversar e tentar amizade',action:()=>{ state.affection+=2; goTo('bonding'); }},
        {text:'Dar espaço, mostrar interesse outra hora',action:()=>{ state.affection+=1; goTo('bonding'); }}
      ]},

      // Act 3
      bonding:{ bg:BACKGROUNDS.corridor, lines:[
        {s:'Narrador',t:'Com encontros discretos, ela começa a rir de leve de suas piadas. Fica vermelha com elogios.'},
        {s:'Ela',t:'Obrigado por não tratar como todos tratam.'}
      ], choices:[
        {text:'Defender quando zoam ela',action:()=>{ state.affection+=3; goTo('after_defend'); }},
        {text:'Ficar quieto',action:()=>{ state.affection-=1; goTo('after_quiet'); }},
        {text:'Tentar mudar de assunto',action:()=>{ goTo('after_change'); }}
      ]},

      after_defend:{ bg:BACKGROUNDS.corridor, lines:[{s:'Narrador',t:'Você a defende. Ela respira aliviada, aproxima-se.'},{s:'Ela',t:'...Obrigada. Você é diferente.'}], choices:[{text:'Continuar',action:()=>goTo('special_event')} ]},
      after_quiet:{ bg:BACKGROUNDS.corridor, lines:[{s:'Narrador',t:'Você fica quieto. Ela parece magoada e se afasta um pouco.'}], choices:[{text:'Continuar',action:()=>goTo('romance_check')} ]},
      after_change:{ bg:BACKGROUNDS.corridor, lines:[{s:'Narrador',t:'Você evita confronto. Ela fica agradecida pela paz.'}], choices:[{text:'Continuar',action:()=>goTo('romance_check')} ]},

      special_event:{ bg:BACKGROUNDS.library, lines:[
        {s:'Narrador',t:'Um dia chuvoso. Você divide o guarda-chuva com ela e caminha até a biblioteca.'},
        {s:'Ela',t:'Nunca tive alguém tão... por perto.'}
      ], choices:[{text:'Falar sobre o passado dela',action:()=>{ state.affection+=1; goTo('romance_check'); }},{text:'Manter a conversa leve',action:()=>goTo('romance_check')} ]},

      // Act 4 - romance check and endings
      romance_check:{ bg:BACKGROUNDS.street, lines:[{s:'Narrador',t:()=>{ if(state.affection>=6) return 'Afeto alto: ela espera por você após a aula e compartilha segredos. Você sente que pode confessar.'; if(state.affection>=3) return 'Afeto médio: vocês são bons amigos, a conexão é sincera.'; return 'Afeto baixo: ela se fecha mais e a relação esfriou.'; }}], choices:[{text:'Ver final',action:()=>goTo('ending')} ]},

      // endings
      confess:{ bg:BACKGROUNDS.street, lines:[{s:'Você',t:'Eu gosto de você.'},{s:'Ela',t:'...Eu também. Nunca pensei que diria isso.'}], choices:[{text:'Final romântico',action:()=>goTo('credits')} ]},

      ending:{ bg:BACKGROUNDS.street, lines:[{s:'Narrador',t:()=>{ if(state.affection>=6) return 'Final: Romance. Vocês iniciam um relacionamento carinhoso.'; if(state.affection>=3) return 'Final: Amizade. Vocês permanecem próximos e cuidam um do outro.'; return 'Final: Distanciamento. A história termina com uma janela fechada.'; }}], choices:[{text:'Créditos',action:()=>goTo('credits')},{text:'Recomeçar',action:()=>startMenu()} ]},

      credits:{ bg:BACKGROUNDS.classroom, lines:[{s:'Sistema',t:'Obrigado por jogar!'}], choices:[{text:'Voltar ao menu',action:()=>startMenu()} ] }
    };

    // helper functions
    function setBG(url){ stage.style.backgroundImage = `url('${url}')`; }
    function setExpression(key){ const url = EXPRESSIONS[key] || EXPRESSIONS.neutral; charImg.src = url; }

    function goTo(key){ const s = SCENES[key]; if(!s) return console.warn('Cena não encontrada',key); state.sceneKey=key; setBG(s.bg || BACKGROUNDS.classroom);
      // build lines array resolving functions
      state.lines = s.lines.map(l=>({s:l.s,t:typeof l.t === 'function'? l.t(): l.t})); state.lineIndex=0; state.pendingChoices = s.choices || null;
      menuOverlay.style.display='none'; ui.style.display='flex'; renderLine(); }

    // render line with typewriter
    let typer=null;
    function renderLine(){ const l = state.lines[state.lineIndex]; if(!l){ showChoices(); return; }
      nameBox.textContent = l.s;
      const text = (l.t||'').replaceAll('{playerName}', state.playerName);
      dialogueText.textContent=''; if(typer) clearInterval(typer);
      let i=0; typer=setInterval(()=>{ i++; dialogueText.textContent = text.slice(0,i); if(i>=text.length){ clearInterval(typer); typer=null; } },16);
      // expression heuristics
      if(l.s === 'Ela') setExpression('shy'); else if(l.s === 'Você') setExpression('neutral'); else setExpression('neutral');
    }

    function advance(){ if(typer){ clearInterval(typer); typer=null; const l = state.lines[state.lineIndex]; dialogueText.textContent = (typeof l.t === 'string'? l.t.replaceAll('{playerName}', state.playerName): l.t); return; }
      state.lineIndex++; if(state.lineIndex < state.lines.length) renderLine(); else showChoices(); }

    function showChoices(){ choicesInner.innerHTML=''; if(state.pendingChoices && state.pendingChoices.length){ choicesContainer.style.display='flex'; state.pendingChoices.forEach(c=>{ const b=document.createElement('button'); b.className='choiceBtn'; b.textContent=c.text; b.onclick=()=>{ choicesContainer.style.display='none'; c.action(); updateAffectionUI(); }; choicesInner.appendChild(b); }); } else { // no choices -> just show continue
        const b=document.createElement('button'); b.className='choiceBtn'; b.textContent='Continuar'; b.onclick=()=>{ choicesContainer.style.display='none'; startMenu(); }; choicesInner.appendChild(b); choicesContainer.style.display='flex'; }
    }

    function updateAffectionUI(){ /* placeholder: could show affection or effects */ }

    // start menu
    function startMenu(){ state.sceneKey='menu'; setBG(SCENES.menu.bg); menuOverlay.style.display='flex'; ui.style.display='none'; choicesContainer.style.display='none'; setExpression('neutral'); }

    // play button
    playBtn.onclick = ()=>{ const n = prompt('Digite seu nome:', 'Você'); state.playerName = n && n.trim() ? n.trim() : 'Você'; goTo('intro'); };
    continueBtn.onclick = ()=>{ const save = loadSave(); if(save) { Object.assign(state, save); // jump to saved scene
        if(state.sceneKey && SCENES[state.sceneKey]) goTo(state.sceneKey); else startMenu(); } else alert('Nenhum salvamento encontrado.'); };
    loadBtn.onclick = continueBtn.onclick;

    // click advance (but ignore clicks on choice buttons)
    document.addEventListener('click', e=>{ if(e.target.closest('.choiceBtn')) return; if(menuOverlay.style.display !== 'none') return; if(choicesContainer.style.display === 'flex') return; advance(); });

    // keyboard
    window.addEventListener('keydown', e=>{ if(e.key===' '|| e.key==='Enter') advance(); if(e.key==='Escape') startMenu(); if(e.key==='s' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); saveGame(); }});

    // simple save/load to localStorage
    function saveGame(){ const save = { playerName: state.playerName, affection: state.affection, sceneKey: state.sceneKey, lineIndex: state.lineIndex }; localStorage.setItem('vn_save', JSON.stringify(save)); alert('Jogo salvo.'); }
    function loadSave(){ const s = localStorage.getItem('vn_save'); return s? JSON.parse(s): null; }

    // initial
    startMenu();

  </script>
</body>
</html>
